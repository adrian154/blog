<!DOCTYPE html><html lang="en" class="serif"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>WIP</title><meta property="og:title" content="WIP"><meta property="og:type" content="website"><link rel="stylesheet" href="/stylesheets/highlight-style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><link rel="stylesheet" href="/stylesheets/main.css"><script>const loadSetting = name => {
    if(localStorage.getItem(name) === "true")
        document.documentElement.classList.add(name);
    else
        document.documentElement.classList.remove(name);
};

loadSetting("serif");
loadSetting("darkmode");</script><script defer src="/scripts/ui.js"></script><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.png"><link rel="canonical" href="https://blog.bithole.dev/blogposts/badge"></head><body><header><p><a id="home-link" href="/">Â« more posts</a></p><h1 id="post-title">WIP</h1></header><main><p>One of <a href="https://en.wikipedia.org/wiki/DEF_CON">DEFCON</a>&#39;s most fascinating traditions is the badges&mdash;little electronic circuits you wear around your neck that do cool things. Every year, the convention has an official badge given to all attendees, but there are also dozens of unofficial ones created by individuals. This year will mark my second DEFCON, and this time, I wanted to have my own cool gadget to show off. So I set out to design and build my own badge.</p>
<p>I started by brainstorming what I wanted the badge to do. Blinkenlights are cool, but it&#39;s not really my thing. </p>
<p>I had a spare <a href="https://wiki.radxa.com/RockpiS">RockPi S</a> lying around from a previous project, so I decided to use it for my prototype. It&#39;s a little single-board computer powered by a 64-bit ARM SoC, so kind of like a Raspberry Pi.</p>
<p>The first part to arrive was a little LCD screen, so I decided to try and get that working first. Unfortunately, I am a total n00b when it comes to electronics and embedded systems, so I spent an unnecessary amount of time and money trying to accomplish this simple task. What follows is an account of how I repeatedly shot myself in the foot while stumbling around in the darkness of my ignorance. (Hopefully my suffering will bring you some laughter.)</p>
<p>I initially expected things to be simple. Hook up the right pins to the right headers, and we&#39;re done. I made one fatal mistake, however: I underestimated my ability to screw up even the most trivial of tasks. My proficiency at turning a simple procedure into a long, torturous slog really can&#39;t be overstated.</p>
<p>Right at the outset, things started off on a funky note. According to the documentation, the RockPi has two SPI buses, although the pinout clearly claims the existence of three. The SCLK and CS pins for SPI0 are, puzzlingly, missing, however, so I went with SPI1. The LCD module also requires a couple GPIO pins, so I had to modify the vendor&#39;s code (which was written for a Raspberry Pi).</p>
<p>At this point, I decided that we were ready to take the whole contraption for a spin. I ran the test program, and&mdash;what&#39;s this? Oops, looks like we forgot to enable spidev. No biggie, just a quick edit to uEnv.txt to enable the right device tree overlay and we&#39;ll be back on our feet. (Suspiciously, the device tree docs claim that the board only has <em>one</em> SPI bus.) I reboot the board, thinking nothing of it, and wait for the light to come on. And wait. And wait&hellip;</p>
<p>Well, it looks like that quick edit rendered the system unbootable. Some research confirms my mistake: I forgot to remove the uart0 overlay, which uses the same pins and thus can&#39;t be enabled at the same time. No matter, I can just revert the change, and peace will be restored. One small problem though: my Windows desktop won&#39;t mount the boot partition for some reason, even though it&#39;s VFAT. <em>Ugh</em>. I&#39;m too tired to try and wrangle with Bill Gates&#39; satan-spawn today, so I dig out the old Linux laptop from the server closet (which also functions as a regular closet), only to realize it doesn&#39;t have a MicroSD reader.</p>
<p><em>I would laugh if it weren&#39;t so tragic.</em></p>
<p>That&#39;s okay, there&#39;s a MicroSD adapter somewhere in the house, but where, where? After a short frenzied search, I finally find an adapter in an old pile of cables. I spring into action, plugging it into the laptop and mounting the boot partition at record speed, but what&#39;s this? Mounted as read-only? <strong>Why?!?</strong> I take out the MicroSD adapter, only to realize that the god damn read lock has broken off, rendering it permanently unwriteable.</p>
<p><em>Sigh</em>. I can almost hear my inner Luddite protesting. At that moment, I am more than ready to adopt his ways and lay waste to every electronic device within reach, but I&#39;m stronger than that. Deep breaths.</p>
<p>Remarkably, a broken read lock can be fixed by simply jamming some tinfoil into the empty slot where it once lived. At last, I can mount the boot partition, fix my mistakes, and finally run the damn test program.</p>
<p>Of course, the screen doesn&#39;t work. No smoke, though, and at least the backlight comes on. At this point I&#39;m not really sure what&#39;s wrong, besides the fact that data is clearly not making it to the screen. After a bit of fruitless tinkering, I bit the bullet and ordered a cheap logic analyzer so I can actually troubleshoot what&#39;s going on.</p>
<p style="text-align: center"><i>Two days later&hellip;</i></p>

<p>The logic analyzer is here. I eagerly hook it up to the board and fire up PulseView, only to be greeted with a whole lot of nothing. <em>Nothing.</em> Nothing on MOSI, nothing on SCLK even. What the hell?</p>
<p>It&#39;s at this point that I start looking at the pinout more carefully, and my heart starts to sink. It was the damn orientation. I was looking at the pinout chart upside-down. I can&#39;t believe such an utterly <em>stupid</em> mistake cost me so much time and sanity. At least I ended up acquiring a tool that will probably come in handy again in the future. And, well, I got the damn screen working.</p>
<figure style="max-width: 500px">
    <img loading="lazy" src="screen.jpg" alt="the board and screen showing trollface">
    <figcaption>0/10. Would not recommend.</figcaption>
</figure>
<img id="img-view" style="display: none"><noscript><b>Please enable Javascript to view the comments on this post.</b></noscript><script src="https://utteranc.es/client.js" crossorigin="anonymous" repo="adrian154/blog" issue-term="title" label="blog-post-comments" theme="preferred-color-scheme"></script></main><footer><p>&copy; 2022 <a href="https://bithole.dev/">Adrian Zhang</a> &bull; <a href="/rss.xml">rss</a> &bull; <a href="https://github.com/adrian154/blog/tree/main/public/blogposts/badge">source</a> &bull; <a href="https://creativecommons.org/licenses/by-sa/3.0/legalcode">CC BY-SA 3.0</a></p></footer></body></html>