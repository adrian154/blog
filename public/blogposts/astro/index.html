<!DOCTYPE html><html lang="en" class="serif"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>The Science of Processing Astrophotos</title><meta property="og:title" content="The Science of Processing Astrophotos"><meta property="og:type" content="website"><meta property="og:description" content="Dipping our toes in the theory behind pretty space pictures"><meta name="description" content="Dipping our toes in the theory behind pretty space pictures"><link rel="stylesheet" href="/stylesheets/highlight-style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><link rel="stylesheet" href="/stylesheets/main.css"><link rel="preconnect" href="https://rsms.me/"><link rel="stylesheet" href="https://rsms.me/inter/inter.css"><script>const loadSetting = name => {
    if(localStorage.getItem(name) === "true")
        document.documentElement.classList.add(name);
    else
        document.documentElement.classList.remove(name);
};

loadSetting("serif");
loadSetting("darkmode");</script><script defer src="/scripts/ui.js"></script><link rel="icon" type="image/png" sizes="16x16" href="/favicon.png"><link rel="canonical" href="https://blog.bithole.dev/blogposts/astro"></head><body><header><h1 id="post-title">The Science of Processing Astrophotos</h1></header><main><p>As an amateur astronomer, my favorite class of objects is definitely the <em>deep-sky objects</em>. This category includes anything outside of the solar system besides individual stars, so think nebulae, star clusters, and galaxies. DSOs offer a stunning range of colors and shapes that make them, in my opinion, some of the most beautiful sights the cosmos has to offer. So, naturally, I wanted to take some pictures of them!</p>
<p>Due to their diversity, it&#39;s hard to make blanket statements about DSOs, but the following is true for most deep-sky targets: they are very dim, and often quite small. This makes imaging them quite a challenge; if you&#39;ve ever researched or attempted it, you may know that the most widely taught method is quite an unusual ritual with a lot of steps whose purpose is not fully explained. The goal of this article is to deconstruct the theoretical basis of deep-sky astrophotography.</p>
<h1 id="noise">Noise <a class="section-link" href="#noise">&sect;</a></h1><p>DSO AP boils down to detecting a faint signal in a noisy environment. If the noise </p>
<h2 id="shot-noise">Shot Noise <a class="section-link" href="#shot-noise">&sect;</a></h2><p>For now, forget about the telescope or ISO or any of those complications. Imagine a single pixel that counts every photon that falls onto it; no more, no less. In other words, a perfect detector. Yet if we point this sensor at a light source of fixed intensity and take a series of exposures, the measurements will still vary! The reason is simple: the time between photon arrivals is random, creating noise that affects even a ideal detector. This type of noise is known as <em>shot noise</em>, and in most cases, it is the largest source of noise in an image.</p>
<p>{TODO: animation of photons falling onto sensor w/ measurements over time}</p>
<p>Shot noise follows a <a href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a>, but under many conditions, it can be approximated as a normal distribution with equal mean and variance. Standard deviation is defined as the square root of variance, so we have:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi mathvariant="normal">S</mi><mi mathvariant="normal">N</mi><mi mathvariant="normal">R</mi></mrow><mo>=</mo><mfrac><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow><msqrt><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msqrt></mfrac><mo>=</mo><msqrt><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">l</mi></mrow></msqrt></mrow><annotation encoding="application/x-tex">\mathrm{SNR} = \frac{\mathrm{signal}}{\sqrt{\mathrm{signal}}} = \sqrt{\mathrm{signal}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord"><span class="mord mathrm">SNR</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3014em;vertical-align:-0.93em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.275em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.835em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathrm">signal</span></span></span></span><span style="top:-2.795em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.205em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">signal</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2561em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9839em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathrm">signal</span></span></span></span><span style="top:-2.9439em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2561em;"><span></span></span></span></span></span></span></span></span></span></p>
<p>I tested this by simulating exposures of a source randomly emitting photons at a rate of 100 photons/second. The results match very well with the predicted SNR:</p>
<p><img loading="lazy" src="snr-vs-exposure.png" alt="graph showing simulated versus theoretical SNR values versus exposure length, showing the square-root relationship"></p>
<p>The big takeaway from this relationship is that to minimize the effects of noise, you want to maximize the amount of signal arriving at your sensor. To accomplish this, you have a few options:</p>
<ul>
<li>Use a longer exposure</li>
<li>Open up your aperture more</li>
<li>Illuminate the scene with more light (this is obviously not an option for astrophotography)</li>
</ul>
<p>Of course, real sensors hardly conform to the idealized model described earlier. Rather, they suffer from a number of imperfections that are also important to consider.</p>
<h2 id="dark-current">Dark Current <a class="section-link" href="#dark-current">&sect;</a></h2><p>If you click the shutter with the lens cap on and viewfinder blocked, you will get... a black picture. No big surprise there. But if you examine the pixel values in this image, you&#39;ll find that they are not zero. Rather, there is a small signal is present even when there is no light incident on the sensor. This signal is called <em>dark current</em>, and it is the result of minuscule defects in the pixel causing spontaneous production of electrons independent of any light falling on the sensor. Different pixels generate dark current at different rates; some outlier &quot;hot pixels&quot; generate dark current at especially high rates. And because the production of dark current electrons is a fundamentally random process dark current will also vary randomly due to shot noise.</p>
<p>{TODO: dark frame showing dark current}</p>
<p>As before, the only way to reduce the random component of dark current is to take more exposures. However, we can estimate the level of dark current for each pixel by taking a series of dark frames (frames where the sensor is not exposed to any light), averaging them, and subtracting the result from our light frames. This eliminates the random contribution </p>
<p>While we usually don&#39;t think of it as noise, light pollution, in a way, fits the bill: it&#39;s an unwanted, randomly varying signal that is present in our measurements.</p>
<h2 id="read-noise">Read Noise <a class="section-link" href="#read-noise">&sect;</a></h2><img id="img-view" style="display: none"></main><footer><p>&copy; 2022 <a href="https://bithole.dev/">Adrian Zhang</a> &bull; <a href="/rss.xml">rss</a> &bull; <a href="https://github.com/adrian154/blog/tree/main/public/blogposts/astro">source</a> &bull; <a href="https://creativecommons.org/licenses/by-sa/3.0/legalcode">CC BY-SA 3.0</a></p></footer></body></html>