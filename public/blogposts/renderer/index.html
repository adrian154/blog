<!DOCTYPE html><html lang="en" class="serif"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Coding a Renderer to Recreate a Meme</title><meta property="og:title" content="Coding a Renderer to Recreate a Meme"><meta property="og:type" content="website"><link rel="stylesheet" href="/stylesheets/highlight-style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><link rel="stylesheet" href="/stylesheets/main.css"><script>const loadSetting = name => {
    if(localStorage.getItem(name) === "true")
        document.documentElement.classList.add(name);
    else
        document.documentElement.classList.remove(name);
};

loadSetting("serif");
loadSetting("darkmode");</script><script defer src="/scripts/ui.js"></script><link rel="icon" type="image/png" sizes="16x16" href="/favicon.png"><link rel="canonical" href="https://blog.bithole.dev/blogposts/renderer"></head><body><header><p><a id="home-link" href="/">Â« more posts</a></p><h1 id="post-title">Coding a Renderer to Recreate a Meme</h1></header><main><p>I am a big fan of 3D text reaction images. If you are unfamiliar with this class of reaction images, here is one of the progenitors of the family:</p>
<figure style="max-width: 400px">
    <img loading="lazy" src="original.png" alt='3D render of text that reads "GAY SEX"'>
    <figcaption>3D render of text that reads "GAY SEX" &mdash; <a href="https://twitter.com/GlitchyPSI">@GlitchyPSI</a></figcaption>
</figure>

<p>My sense of humor might be a little broken.</p>
<p>Anyways, I like making stuff to do with 3D graphics, so I decided to recreate this meme from scratch. That means writing code to generate the model, and then creating a pathtracer to render that model using realistic lighting. Let&#39;s dive in.</p>
<h1 id="the-model">The Model <a class="section-link" href="#the-model">&sect;</a></h1><p>Let&#39;s begin by building a 3D model of the scene. There are existing tools for generating meshes from text like <a href="https://text2stl.mestres.fr/en-us/generator">Text2STL</a>, but I opted to create my own solution so I could fine-tune the parameters.</p>
<p>Right now, our goal is to convert each character into a list of points representing the outline. A good place to start is <a href="https://opentype.js.org/">opentype.js</a>, which takes a string and turns it into an SVG path. This frees us from decoding the font files, handling things like kerning, etc. Even <em>I</em> have limits :^)</p>
<p>Feeding &quot;GAY SEX&quot; and a copy of the Impact font file into opentype.js leaves us with a list of commands that looks like this:</p>
<pre><code class="hljs"><span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;M&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">225.078125</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">126.5234375</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;L&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">225.078125</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">140.1953125</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;L&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">142.8515625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">140.1953125</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;L&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">142.8515625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">111.484375</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Q&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">142.8515625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">84.3359375</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">140.5078125</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">77.5</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Q&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">138.1640625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">70.6640625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.375</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">70.6640625</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;L&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">129.375</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">70.6640625</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Q&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">121.7578125</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">70.6640625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">119.0234375</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">76.5234375</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Q&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">116.2890625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y1&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">82.3828125</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;x&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">116.2890625</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;y&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-number">106.6015625</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    ...
<span class="hljs-punctuation">]</span></code></pre><p>The meaning of each command is determined by the <code>type</code> field. For Impact, we need to deal with four key commands:</p>
<ul>
<li><code>M</code>: begin a new path starting at (x, y)</li>
<li><code>L</code>: draw a straight line from the previous position to (x, y)</li>
<li><code>Q</code>: draw a B&eacute;zier curve to (x, y) with a control point at (x1, y1)</li>
<li><code>Z</code>: close the path</li>
</ul>
<p>Most of these commands are pretty trivial, except for <code>Q</code>. I didn&#39;t really know how B&eacute;zier curves worked, so I replaced them with straight lines on my initial attempt. Here&#39;s what the result looks like:</p>
<p><img loading="lazy" src="no-interpolation.png" alt="text rendered without bezier curve"></p>
<p>Not <em>terrible</em>, but it&#39;s rather jagged. Let&#39;s fix this.</p>
<p>A B&eacute;zier curve, simply put, is a way of defining a smooth curve using a control point in addition to a starting and ending point. Impact uses quadratic B&eacute;zier curves, which are created by tracing a point on an imaginary line that spans between the lines connecting the two anchor points to the control point. It&#39;s a rather tricky concept to put into words, frankly, so here&#39;s a widget demonstrating the concept that you can interact with.</p>
<p><canvas id="bezier-demo" style="width: 100%"></canvas>
<input type="range" id="bezier-t" style="width: 100%" min="0" max="100" step="1">  </p>
<script src="bezier.js"><img id="img-view" style="display: none"><noscript><b>Please enable Javascript to view the comments on this post.</b></noscript><script src="https://utteranc.es/client.js" crossorigin="anonymous" repo="adrian154/blog" issue-term="title" label="blog-post-comments" theme="preferred-color-scheme"></script></main><footer><p>&copy; 2022 <a href="https://bithole.dev/">Adrian Zhang</a> &bull; <a href="/rss.xml">rss</a> &bull; <a href="https://github.com/adrian154/blog/tree/main/public/blogposts/renderer">source</a> &bull; <a href="https://creativecommons.org/licenses/by-sa/3.0/legalcode">CC BY-SA 3.0</a></p></footer></body></html>