<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Annotated TLS Session</title><meta property="og:title" content="Annotated TLS Session"><meta property="og:type" content="website"><meta property="og:description" content="Ever wanted to understand the significance of every byte exchanged in a TLS session? You can now."><meta name="description" content="Ever wanted to understand the significance of every byte exchanged in a TLS session? You can now."><link rel="canonical" href="https://blog.bithole.dev/tls-interactive.html"><link rel="stylesheet" href="static/stylesheets/main.css"><link rel="stylesheet" href="static/stylesheets/highlight-style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css"><link rel="stylesheet" href="static/stylesheets/packetview.css"><script defer="null" src="static/scripts/packetview.js"></script></head><body><a href="/"><img src="static/images/banner0.jpg" alt="blog banner"></a><p id="date" class="date">January 23, 2022</p><h1 style="margin-top: 0">Annotated TLS Session</h1><p><noscript><b>If you are reading this message, JavaScript is not enabled. Unfortunately, this page relies on JS to dynamically generate content which you may not be able to view.</b></noscript></p>
<p>You can download the full packet capture of the exchange <a href="static/tls-capture.pcapng">here</a>. You&#39;ll also need the <a href="static/tls-keylog.txt">keylog</a> to decrypt the capture.</p>
<h1 id="c--s-client-hello">C â†’ S: Client Hello <a class="section-link" href="#c--s-client-hello">&sect;</a></h1><p>TLS handshakes begin with the Client Hello message, where the client declares to the server its capabilities, e.g. TLS version and supported ciphers.</p>
<p><strong>Hint</strong>: Click on a section of the packet to see a description of what it does.</p>
<div class="packet">
<div class="hex-data" data-hex="1603010154" data-name="Record Header">

<p>All records begin with a <a href="https://datatracker.ietf.org/doc/html/rfc8446#appendix-B.1">header</a> that gives information about the content of the record.</p>
<ul>
<li><code>16</code>: record type (22 for handshake)</li>
<li><code>03 01</code>: protocol version (TLS 1.0 for backwards compatibility)</li>
<li><code>01 54</code>: length of payload (340 bytes)</li>
</ul>
</div>
<div class="hex-data" data-hex="01000150" data-name="Handshake Header">

<p>The <a href="https://datatracker.ietf.org/doc/html/rfc8446#appendix-B.3">Handshake</a> record begins with a four-byte header describing the contained data.</p>
<ul>
<li><code>01</code>: message type (1 for ClientHello)</li>
<li><code>00 01 50</code>: message length (336 bytes)</li>
</ul>
</div>
<div class="hex-data" data-hex="0303" data-name="ClientHello Version">

<p>In TLS 1.2 and below, this field indicated the highest version supported by the client. However, using this field for version negotiation has been deprecated in favor of the <code>supported_versions</code> extension, so in TLS 1.3 this field <em>must</em> be set to <code>0x0303</code> (TLS 1.2).</p>
</div>
<div class="hex-data" data-hex="f70d1790e5eb5b81c70815f47bf41703165542f3b734f609924fb0e4f16a7c6f" data-name="Random">

<p>The client provides 32 bytes of randomness that are used in {TODO} later in the handshake.</p>
</div>
<div class="hex-data" data-hex="20bada4ab837b92b32c76ca330c0b859485f7eac0ead4c4fba4c440cf3c3b045a1" data-name="Legacy Session ID">

<p>Previously, this value was used to identify clients across sessions. However, since this functionality is now handled by pre-shared keys in TLS 1.3, clients just generate a random session ID each time to avoid confusing intermediate clients which may only support TLS 1.2.</p>
<ul>
<li><code>20</code>: length of the session ID (between 0 and 32)</li>
<li><code>ba da 4a ... b0 45 a1</code>: session id</li>
</ul>
</div>
<div class="hex-data" data-hex="0076130213031301c02fc02bc030c02c009ec0270067c028006b00a3009fcca9cca8ccaac0afc0adc0a3c09fc05dc061c057c05300a2c0aec0acc0a2c09ec05cc060c056c052c024006ac0230040c00ac01400390038c009c01300330032009dc0a1c09dc051009cc0a0c09cc050003d003c0035002f00ff" data-name="Cipher Suites">

<p>In this section of the handshake, the client lists all the cipher suites which it supports. Each cipher is identified by a two-byte number assigned by <a href="https://www.iana.org/assignments/tls-parameters/tls-parameters.xhtml#tls-parameters-4">IANA</a>.</p>
<ul>
<li><code>00 76</code>: length of cipher suite list (118 bytes)</li>
<li><code>13 02 13 ... 2f 00 ff</code>: list of ciphers in order of preference.<ul>
<li><code>13 02</code>: TLS_AES_256_GCM_SHA384</li>
<li><code>13 03</code>: TLS_CHACHA20_POLY1305_SHA256</li>
<li><code>13 01</code>: TLS_AES_128_GCM_SHA256</li>
<li><code>c0 2f</code>: TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li>
<li><code>c0 2b</code>: TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</li>
<li><code>c0 30</code>: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</li>
<li><code>c0 2c</code>: TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</li>
<li><code>00 9e</code>: TLS_DHE_RSA_WITH_AES_128_GCM_SHA256</li>
<li><code>c0 27</code>: TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256</li>
<li><code>00 67</code>: TLS_DHE_RSA_WITH_AES_128_CBC_SHA256</li>
<li><code>c0 28</code>: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384</li>
<li><code>00 6b</code>: TLS_DHE_RSA_WITH_AES_256_CBC_SHA256</li>
<li><code>00 a3</code>: TLS_DHE_DSS_WITH_AES_256_GCM_SHA384</li>
<li><code>00 9f</code>: TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</li>
<li><code>cc a9</code>: TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256</li>
<li><code>cc a8</code>: TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256</li>
<li><code>cc aa</code>: TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256</li>
<li><code>c0 af</code>: TLS_ECDHE_ECDSA_WITH_AES_256_CCM_8</li>
<li><code>c0 ad</code>: TLS_ECDHE_ECDSA_WITH_AES_256_CCM</li>
<li><code>c0 a3</code>: TLS_DHE_RSA_WITH_AES_256_CCM_8</li>
<li><code>c0 9f</code>: TLS_DHE_RSA_WITH_AES_256_CCM</li>
<li><code>c0 5d</code>: TLS_ECDHE_ECDSA_WITH_ARIA_256_GCM_SHA384</li>
<li><code>c0 61</code>: TLS_ECDHE_RSA_WITH_ARIA_256_GCM_SHA384</li>
<li><code>c0 57</code>: TLS_DHE_DSS_WITH_ARIA_256_GCM_SHA384</li>
<li><code>c0 53</code>: TLS_DHE_RSA_WITH_ARIA_256_GCM_SHA384</li>
<li><code>00 a2</code>: TLS_DHE_DSS_WITH_AES_128_GCM_SHA256</li>
<li><code>c0 ae</code>: TLS_ECDHE_ECDSA_WITH_AES_128_CCM_8</li>
<li><code>c0 ac</code>: TLS_ECDHE_ECDSA_WITH_AES_128_CCM</li>
<li><code>c0 a2</code>: TLS_DHE_RSA_WITH_AES_128_CCM_8</li>
<li><code>c0 9e</code>: TLS_DHE_RSA_WITH_AES_128_CCM</li>
<li><code>c0 5c</code>: TLS_ECDHE_ECDSA_WITH_ARIA_128_GCM_SHA256</li>
<li><code>c0 60</code>: TLS_ECDHE_RSA_WITH_ARIA_128_GCM_SHA256</li>
<li><code>c0 56</code>: TLS_DHE_DSS_WITH_ARIA_128_GCM_SHA256</li>
<li><code>c0 52</code>: TLS_DHE_RSA_WITH_ARIA_128_GCM_SHA256</li>
<li><code>c0 24</code>: TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384</li>
<li><code>00 6a</code>: TLS_DHE_DSS_WITH_AES_256_CBC_SHA256</li>
<li><code>c0 23</code>: TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256</li>
<li><code>00 40</code>: TLS_DHE_DSS_WITH_AES_128_CBC_SHA256</li>
<li><code>c0 0a</code>: TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</li>
<li><code>c0 14</code>: TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</li>
<li><code>00 39</code>: TLS_DHE_RSA_WITH_AES_256_CBC_SHA</li>
<li><code>00 38</code>: TLS_DHE_DSS_WITH_AES_256_CBC_SHA</li>
<li><code>c0 09</code>: TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA</li>
<li><code>c0 13</code>: TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</li>
<li><code>00 33</code>: TLS_DHE_RSA_WITH_AES_128_CBC_SHA</li>
<li><code>00 32</code>: TLS_DHE_DSS_WITH_AES_128_CBC_SHA</li>
<li><code>00 9d</code>: TLS_RSA_WITH_AES_256_GCM_SHA384</li>
<li><code>c0 a1</code>: TLS_RSA_WITH_AES_256_CCM_8</li>
<li><code>c0 9d</code>: TLS_RSA_WITH_AES_256_CCM</li>
<li><code>c0 51</code>: TLS_RSA_WITH_ARIA_256_GCM_SHA384</li>
<li><code>00 9c</code>: TLS_RSA_WITH_AES_128_GCM_SHA256</li>
<li><code>c0 a0</code>: TLS_RSA_WITH_AES_128_CCM_8</li>
<li><code>c0 9c</code>: TLS_RSA_WITH_AES_128_CCM</li>
<li><code>c0 50</code>: TLS_RSA_WITH_ARIA_128_GCM_SHA256</li>
<li><code>00 3d</code>: TLS_RSA_WITH_AES_256_CBC_SHA256</li>
<li><code>00 3c</code>: TLS_RSA_WITH_AES_128_CBC_SHA256</li>
<li><code>00 35</code>: TLS_RSA_WITH_AES_256_CBC_SHA</li>
<li><code>00 2f</code>: TLS_RSA_WITH_AES_128_CBC_SHA</li>
<li><code>00 ff</code>: TLS_EMPTY_RENEGOTIATION_INFO_SCSV</li>
</ul>
</li>
</ul>
<p>TLS 1.3 only recommends five cipher suites, of which three are listed: TLS_AES_256_GCM_SHA384, TLS_CHACHA20_POLY1305_SHA256, and TLS_AES_128_GCM_SHA256. However, 56 other cipher suites are listed. They are present for backwards compatibility, but using these ciphers is discouraged. </p>
</div>
<div class="hex-data" data-hex="0100" data-name="Legacy Compression Methods">

<p>Previously, compression methods were listed here. In TLS 1.3, compression is no longer supported due to security vulnerabilities, so this field contains a single null byte.</p>
<ul>
<li><code>01</code>: field length</li>
<li><code>00</code>: null</li>
</ul>
</div>
<div class="hex-data" data-hex="0091" data-name="Extensions">

<p>The extensions section contains records providing more information about the client. A full list of extensions and their respective RFCs can be found <a href="https://www.iana.org/assignments/tls-extensiontype-values/tls-extensiontype-values.xhtml">here</a>.</p>
<ul>
<li><code>00 91</code>: length of extensions (145 bytes)</li>
</ul>
</div>
<div class="hex-data" data-hex="000b000403000102" data-name="Extension: ec_point_formats">

<p>This extension lists the <a href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography">elliptic curve</a> encodings that the client can parse.</p>
<ul>
<li><code>00 0b</code>: extension type (11 for ec_point_formats)</li>
<li><code>00 04</code>: extension data length (4 bytes)<ul>
<li><code>03</code>: length of format list (3 bytes)<ul>
<li><code>00</code>: uncompressed points are supported</li>
<li><code>01 02</code>: deprecated formats (<a href="https://standards.globalspec.com/std/1955141/ANSI%20X9.62">X.962</a>) which clients must still declare support for, as specified in <a href="https://www.rfc-editor.org/rfc/rfc8422.html#section-5.1.2">RFC 8422</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="hex-data" data-hex="000a000c000a001d0017001e00190018" data-name="Extension: supported_groups">

<p>This extension lists the elliptic curves which the client supports, in order of preference. </p>
<ul>
<li><code>00 0a</code>: extension type (10 for supported_groups)</li>
<li><code>00 0c</code>: extension data length (12 bytes)<ul>
<li><code>00 0a</code>: length of curve list (10 bytes)<ul>
<li><code>00 1d</code>: x25519</li>
<li><code>00 17</code>: secp256r1</li>
<li><code>00 1e</code>: x448</li>
<li><code>00 19</code>: secp512r1</li>
<li><code>00 18</code>: secp384r1</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="hex-data" data-hex="00230000" data-name="Extension: session_ticket">

<p>This extension identifies the client for <a href="https://www.rfc-editor.org/rfc/rfc5077.html">TLS session resumption</a>. In this case, the client signals that it does not have a session ticket yet but is ready to receive one by sending a ticket of length zero.</p>
<ul>
<li><code>00 23</code>: extension type (35 for session_ticket)</li>
<li><code>00 00</code>: data length (none)</li>
</ul>
</div>
<div class="hex-data" data-hex="00160000" data-name="Extension: encrypt_then_mac">

<p>This extension indicates that the client supports the <a href="https://www.rfc-editor.org/rfc/rfc7366.html">encrypt-then-MAC</a> scheme, which aims to fix the security issues inherent to MAC-then-encrypt.</p>
<ul>
<li><code>00 16</code>: extension type (22 for encrypt_then_mac)</li>
<li><code>00 00</code>: data length (none)</li>
</ul>
</div>
<div class="hex-data" data-hex="00170000" data-name="Extension: extended_master_secret">

<p>This extension indicates that the client supports <a href="https://www.rfc-editor.org/rfc/rfc7627.html">extended master secrets</a>, which hardens TLS sessions against man-in-the-middle attacks by calculating the master secret using the hash of prior handshake messages.</p>
<ul>
<li><code>00 17</code>: extension type (23 for extended_master_secret)</li>
<li><code>00 00</code>: data length (none)</li>
</ul>
</div>
<div class="hex-data" data-hex="000d0030002e040305030603080708080809080a080b080408050806040105010601030302030301020103020202040205020602" data-name="Extension: signature_algorithms">

<p>This extension allows clients to declare which digital signature algorithms they support.</p>
<ul>
<li><code>00 0d</code>: extension type (13 for signature_algorithms)</li>
<li><code>00 30</code>: data length (48 bytes)<ul>
<li><code>00 2e</code>: length of signature algorithms list (46 bytes)<ul>
<li><code>04 03</code>: ecdsa_secp256r1_sha256</li>
<li><code>05 03</code>: ecdsa_secp384r1_sha384</li>
<li><code>06 03</code>: ecdsa_secp521r1_sha512</li>
<li><code>08 07</code>: ed25519</li>
<li><code>08 08</code>: ed448</li>
<li><code>08 09</code>: rsa_pss_pss_sha256</li>
<li><code>08 0a</code>: rsa_pss_pss_sha384</li>
<li><code>08 0b</code>: rsa_pss_pss_sha512</li>
<li><code>08 04</code>: rsa_pss_rsae_sha256</li>
<li><code>08 05</code>: rsa_pss_rsae_sha384</li>
<li><code>08 06</code>: rsa_pss_rsae_sha512</li>
<li><code>04 01</code>: rsa_pkcs1_sha256</li>
<li><code>05 01</code>: rsa_pkcs1_sha384</li>
<li><code>06 01</code>: rsa_pkcs1_sha512</li>
<li><code>03 03</code>: SHA224 ECDSA</li>
<li><code>02 03</code>: ecdsa_sha1</li>
<li><code>03 01</code>: SHA224 RSA</li>
<li><code>02 01</code>: rsa_pkcs1_sha1</li>
<li><code>03 02</code>: SHA224 DSA</li>
<li><code>02 02</code>: SHA1 DSA</li>
<li><code>04 02</code>: SHA256 DSA</li>
<li><code>05 02</code>: SHA384 DSA</li>
<li><code>06 02</code>: SHA512 DSA</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="hex-data" data-hex="002b00050403040303" data-name="Extension: supported_versions">

<p>This extension lists the TLS versions which the client supports.</p>
<ul>
<li><code>00 2b</code>: extension type (43 for supported_versions)</li>
<li><code>00 05</code>: data length (5 bytes)<ul>
<li><code>04</code>: length of version list (4 bytes)<ul>
<li><code>03 04</code>: TLS 1.3</li>
<li><code>03 03</code>: TLS 1.2</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="hex-data" data-hex="002d00020101" data-name="Extension: psk_key_exchange_modes">

<p>This extension lists the supported key exchange modes for pre-shared keys. (This session doesn&#39;t use preshared keys, so we won&#39;t be seeing any of these methods in action.)</p>
<ul>
<li><code>00 2d</code>: extension type (45 for psk_key_exchange_modes)</li>
<li><code>00 02</code>: data length (2 bytes)<ul>
<li><code>01 01</code>: PSK with (EC)DHE key establishment</li>
</ul>
</li>
</ul>
</div>
<div class="hex-data" data-hex="003300260024001d002044070648c76db55ef1d560a2e70a10c620432748a134b3065802d08cc801243a" data-name="Extension: key_share">

<p>The client sends its public keys to the server in this extension. If the server supports the algorithm of the key sent in the handshake, all messages following the ClientHello can be encrypted.</p>
<ul>
<li><code>00 33</code>: extension type (51 for key_share)</li>
<li><code>00 26</code>: data length (38 bytes)<ul>
<li><code>00 24</code>: length of key share list<ul>
<li><code>00 1d</code>: the key is to be used with the x25519 signature algorithm</li>
<li><code>00 20</code>: key length (32 bytes)</li>
<li><code>44 07 06 ... 01 24 3a</code>: public key</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<noscript><b>Please enable Javascript to view the comments on this post.</b></noscript><script src="https://utteranc.es/client.js" crossorigin="anonymous" repo="adrian154/blog" issue-term="title" label="blog-post-comments" theme="github-light"></script><p class="footnote">&copy; 2022 <a href="https://bithole.dev/">Adrian Zhang</a> &bull; <a href="rss.xml">rss</a> &bull; <a href="https://github.com/adrian154/blog">contribute</a> &bull; <a href="https://creativecommons.org/licenses/by-sa/3.0/legalcode">CC BY-SA 3.0</a></p></body></html>