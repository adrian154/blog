<!DOCTYPE html>
<html>
    <head>
        <style>
            canvas {
                border: 1px solid #aaa;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas" width="720" height="720"></canvas>
        <script src="colormap.js"></script>
        <script>
            const SIZE = 21, COUNT = 1000000;
            const arr = new Array(SIZE).fill().map(() => new Array(SIZE).fill(0));
            const randint = max => Math.floor(Math.random() * max);
            let oob = 0;
            for(let i = 0; i < COUNT; i++) {
                let x = Math.floor(SIZE/2), y = Math.floor(SIZE/2);
                for(let j = 0; j < 5; j++) {
                    x += randint(6) - randint(6);
                    y += randint(6) - randint(6);
                    if(arr[x] && y >= 0 && y < SIZE) {
                        arr[x][y]++;
                    } else {
                        oob++;
                        break;
                    }
                }
            }
            
            console.log(oob/COUNT*100 + "%");
            
            canvas = document.getElementById("canvas");
            ctx = canvas.getContext("2d");
            const w = 32;
            canvas.width = w * SIZE;
            canvas.height = w * SIZE;
            
            const max = arr.reduce((a, c) => Math.max(a, c.reduce((a,c) => Math.max(a,c), 0)), 0);

            for(let x = 0; x < SIZE; x++) {
                for(let y = 0; y < SIZE; y++) {
                    const c = colormap(arr[x][y] / max, MAGMA);
                    ctx.fillStyle = `rgb(${c[0]*255},${c[1]*255},${c[2]*255})`;
                    ctx.fillRect(x*w,y*w,w,w);
                }
            }

        </script>
        <canvas id="key" width="100" height="800"></canvas>
        <script>
            canvas = document.getElementById("key");
            ctx = canvas.getContext("2d");

            for(let i = 0; i <= 10; i++) {
                ctx.beginPath();
                const y = Math.floor(i / 10 * 674 + 10) + 1.5;
                ctx.moveTo(10, y);
                ctx.lineTo(40, y);
                ctx.closePath();
                ctx.stroke();
            }

            for(let i = 0; i < 674; i++) {
                const c = colormap(i / 674, MAGMA);
                ctx.fillStyle = `rgb(${c[0]*255},${c[1]*255},${c[2]*255})`;
                ctx.fillRect(10, 674 - i + 10, 20, 1);
            }

            ctx.fillStyle = "#000000";
            ctx.font = "12px Arial";
            for(let i = 0; i <= 10; i++) {
                ctx.fillText((10-i)/10, 45, i / 10 * 674 + 15);
            }
        </script>
    </body>
</html>